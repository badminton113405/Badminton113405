{% extends 'base.html' %}

{% block title %}
報名結果
{% endblock %}

{% block content %}
<div class="course-result">

    <h1>報課資訊</h1>

    <!-- 顯示個人資訊 -->
    <ul>
        <li><strong>姓名：</strong> {{ name }}</li>
        <li><strong>性別：</strong> {{ gender }}</li>
        <li><strong>電話：</strong> {{ phone }}</li>
        <li><strong>Email：</strong> {{ email }}</li>
        <li><strong>生日：</strong> {{ birthday }}</li>
    </ul>

    <!-- 顯示選擇的課程 -->
    <h3>選擇的課程</h3>
    <ul>
        {% for course in selected_courses %}
            <li>{{ course }}</li>
        {% endfor %}
    </ul>

    <p>課程費用：<strong>{{ total_cost }}</strong> 元</p>

    <!-- 支付選項 -->
    <button class="nav-button" id="bank-transfer-button">銀行轉帳</button>
    <button class="nav-button" id="cash-payment-button">現金</button>

    <!-- 隱藏表單提交 -->
    <form method="post" action="{% url 'course_success_page' %}" id="hiddenForm">
        {% csrf_token %}
        <input type="hidden" name="name" value="{{ name }}">
        <input type="hidden" name="gender" value="{{ gender }}">
        <input type="hidden" name="phone" value="{{ phone }}">
        <input type="hidden" name="email" value="{{ email }}">
        <input type="hidden" name="birthday" value="{{ birthday }}">
        <input type="hidden" name="selected_courses" value="{{ selected_courses }}">
        <input type="hidden" name="total_cost" value="{{ total_cost }}">
        <input type="hidden" name="payment_type" id="paymentType">
    </form>
</div>

<!-- Modal for Bank Transfer -->
<div id="bankTransferModal" class="modal">
    <div class="modal-content">
        <span class="close-button" id="close-button">&times;</span>
        <h2>銀行轉帳資訊</h2>
        <p>請將費用轉帳至以下賬戶：</p>
        <p><strong>銀行名稱：</strong>合作金庫</p>
        <p><strong>賬戶名稱：</strong>蔡元振</p>
        <p><strong>賬戶號碼：</strong>0400765166568</p>
        <p><strong>轉帳金額：</strong>{{ total_cost }} 元</p>
        <p>完成後請點擊確認按鈕。</p>
        <a href="#"><button class="i-button" id="confirmButton">確認</button></a>
    </div>
</div>

<!-- Modal for Cash Payment -->
<div id="cashPaymentModal" class="modal">
    <div class="modal-content">
        <span class="close-button" id="close-button-cash">&times;</span>
        <h2>現金付款資訊</h2>
        <p>請於一周內至現場付款。</p>
        <p><strong>付款人姓名：</strong>{{ name }}</p>
        <p><strong>付款人電話：</strong>{{ phone }}</p>
        <p><strong>商品總金額：</strong>{{ total_cost }} 元</p>
        <p><strong>地點：</strong>羽你同行羽球館</p>
        <p>完成後請點擊確認按鈕。</p>
        <a href="#"><button class="i-button">確認</button></a>
    </div>
</div>

<!-- 報名成功的訊息彈窗 -->
<div id="successMessageModal" class="modal">
    <div class="modal-content">
        <span class="close-button" id="successCloseButton">&times;</span>
        <h2>報名成功！</h2>
        <p>您已成功報名本課程，感謝您的轉帳。</p>
    </div>
</div>

<!-- Styles for Modal -->
<style>
    .modal {
        display: none; 
        position: fixed; 
        z-index: 1; 
        left: 0;
        top: 0;
        width: 100%; 
        height: 100%; 
        overflow: auto; 
        background-color: rgba(0,0,0,0.4); 
    }

    .modal-content {
        background-color: #fefefe;
        margin: 15% auto; 
        padding: 20px;
        border: 1px solid #888;
        width: 80%; 
        max-width: 500px; 
    }

    .close-button {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }

    .close-button:hover,
    .close-button:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
    }

    .i-button {
        font-family: "Zen Kurenaido", sans-serif;
        border-radius: 16px;
        color: #000;
        background-color: #FBFF36;
    }

    .i-button:hover {
        color: #fff;
        background-color: #777777;
    }
</style>

<!-- JavaScript for Modal Actions -->
<script>
    const bankTransferButton = document.getElementById('bank-transfer-button');
    const cashPaymentButton = document.getElementById('cash-payment-button');
    const hiddenForm = document.getElementById('hiddenForm');
    const paymentTypeInput = document.getElementById('paymentType');

    // Handles modal and form submission
    bankTransferButton.onclick = function() {
        paymentTypeInput.value = 'bank';
        document.getElementById('bankTransferModal').style.display = 'block';
    };

    cashPaymentButton.onclick = function() {
        paymentTypeInput.value = 'cash';
        hiddenForm.submit();
    };

    // Modal close button logic
    document.getElementById('close-button').onclick = function() {
        document.getElementById('bankTransferModal').style.display = 'none';
    };

    // Clicking outside the modal closes it
    window.onclick = function(event) {
        if (event.target === document.getElementById('bankTransferModal')) {
            document.getElementById('bankTransferModal').style.display = 'none';
        }
    };

    // Confirm button logic for bank transfer
    document.getElementById('confirmButton').onclick = function(event) {
        event.preventDefault();  
        document.getElementById('bankTransferModal').style.display = 'none';
        hiddenForm.submit();
    };
</script>

{% endblock %}

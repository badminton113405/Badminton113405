{% extends 'base.html' %}
{% load static %}

{% block title %}<title>商城中心</title>{% endblock %}

{% block content %}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<style>
    @media screen and (max-width: 320px) {
        .g-header-container.fixed {
            padding: 5px;
        }

        .g-footer-container {
            padding: 5px;
        }

        .m-button {
            margin-right: 5px;
            font-size: 12px;
        }
    }

    .title {
        text-align: center;
    }

    .container {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 20px;
        margin: 20px auto;
        width: 90%;
        max-width: 500px;
    }

    .cart-container {
        position: fixed;
        top: 90px;
        right: 20px;
        z-index: 1000;
    }

    .cart-icon {
        font-size: 24px;
    }

    .item-count {
        position: absolute;
        top: -5px;
        right: -10px;
        background-color: red;
        color: white;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
    }

    .product {
        background-color: white;
        border: 1px solid #ddd;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        margin: 10px;
        width: 200px;
        padding: 10px;
    }

    .product img {
        max-width: 100%;
        border-radius: 8px;
    }

    .product h3 {
        font-size: 16px;
        color: #333;
        margin: 10px 0;
    }

    .product p {
        font-size: 14px;
        color: #777;
        margin: 5px 0;
    }

    .product .price {
        font-size: 18px;
        color: #000;
        margin: 5px 0;
    }

    .add-to-cart {
        display: inline-block;
        padding: 10px 20px;
        margin-top: 10px;
        color: white;
        background-color: #000;
        border: none;
        border-radius: 4px;
        text-decoration: none;
        font-size: 14px;
    }

    .add-to-cart:hover {
        cursor: pointer;
    }

    .login-to-cart:hover {
        cursor: pointer;
    }

    .i-button {
        font-family: "Zen Kurenaido", sans-serif;
        border-radius: 16px;
        color: #000;
        background-color: #FFF279;
    }

    .i-button:hover {
        font-family: "Zen Kurenaido", sans-serif;
        border-radius: 16px;
        color: #fff;
        background-color: #777777;
    }

    .button-container {
        text-align: center;
    }
</style>

<div class="mall">
    <div class="title">
        <h1>商城</h1>
    </div>

    <div class="cart-container">
        <a href="javascript:void(0);" id="cart-link">
            <i class="fas fa-shopping-cart cart-icon"></i>
            <span id="item-count" class="item-count">0</span>
        </a>
    </div>

    <div class="container">
        <div class="product" data-id="1" data-name="VICTOR 新手球拍 ARS3200" data-price="1250">
            <a href="{% url 'product01' %}">
                <img src="{% static 'images/market-01.jpg' %}" alt="VICTOR 新手球拍 ARS3200 球拍包含線">
            </a>
            <h3>VICTOR 新手球拍 ARS3200 球拍包含線</h3>
            <p class="price">$1250元</p>
            {% if user.is_authenticated %}
            <a class="add-to-cart">加入購物車</a>
            {% else %}
            <a href="{% url 'login' %}" class="login-to-cart">加入購物車</a>
            {% endif %}
        </div>

        <div class="product" data-id="2" data-name="YONEX AC102 單入 握把布(隨機色)" data-price="35">
            <a href="{% url 'product02' %}">
                <img src="{%static 'images/market-02.jpg' %}" alt="YONEX AC102 單入 握把布(隨機色)">
            </a>
            <h3>YONEX AC102 單入 握把布(隨機色)</h3>
            <p class="price">$35元</p>
            {% if user.is_authenticated %}
            <a class="add-to-cart">加入購物車</a>
            {% else %}
            <a href="{% url 'login' %}" class="login-to-cart">加入購物車</a>
            {% endif %}
        </div>

        <div class="product" data-id="3" data-name="Yonex 運動吸汗護腕AC492EX" data-price="90">
            <a href="{% url 'product03' %}">
                <img src="{%static 'images/market-03.jpg' %}" alt="Yonex 運動吸汗護腕AC492EX">
            </a>
            <h3>Yonex 運動吸汗護腕AC492EX (隨機色)</h3>
            <p class="price">$90元</p>
            {% if user.is_authenticated %}
            <a class="add-to-cart">加入購物車</a>
            {% else %}
            <a href="{% url 'login' %}" class="login-to-cart">加入購物車</a>
            {% endif %}
        </div>

        <div class="product" data-id="4" data-name="VICTOR 勝利 新碳音球 NCS 六入裝 羽毛球" data-price="410">
            <a href="{% url 'product04' %}">
                <img src="{%static 'images/market-04.jpg' %}" alt="VICTOR 勝利 新碳音球 NCS 六入裝 羽毛球">
            </a>
            <h3>VICTOR 勝利 新碳音球 NCS 六入裝 羽毛球</h3>
            <p class="price">$410元</p>
            {% if user.is_authenticated %}
            <a class="add-to-cart">加入購物車</a>
            {% else %}
            <a href="{% url 'login' %}" class="login-to-cart">加入購物車</a>
            {% endif %}
        </div>

        <div class="product" data-id="5" data-name="YONEX 毛巾吸汗運動頭帶 AC259EX(隨機色)" data-price="110">
            <a href="{% url 'product05' %}">
                <img src="{%static 'images/market-05.jpg' %}" alt="YONEX 毛巾吸汗運動頭帶 AC259EX(隨機色)">
            </a>
            <h3>YONEX 毛巾吸汗運動頭帶 AC259EX(隨機色)</h3>
            <p class="price">$110元</p>
            {% if user.is_authenticated %}
            <a class="add-to-cart">加入購物車</a>
            {% else %}
            <a href="{% url 'login' %}" class="login-to-cart">加入購物車</a>
            {% endif %}
        </div>

        <div class="product" data-id="6" data-name="Victor 羽球拍保護半拍套 (內絨布)" data-price="60">
            <a href="{% url 'product06' %}">
                <img src="{%static 'images/market-06.jpg' %}" alt="Victor 羽球拍保護半拍套 (內絨布)">
            </a>
            <h3>Victor 羽球拍保護半拍套 (內絨布)</h3>
            <p class="price">$60元</p>
            {% if user.is_authenticated %}
            <a class="add-to-cart">加入購物車</a>
            {% else %}
            <a href="{% url 'login' %}" class="login-to-cart">加入購物車</a>
            {% endif %}
        </div>

        <div class="product" data-id="7" data-name="VICTOR 球拍袋 羽球拍袋  1支裝" data-price="150">
            <a href="{% url 'product07' %}">
                <img src="{%static 'images/market-07.jpg' %}" alt="VICTOR 球拍袋 羽球拍袋  1支裝">
            </a>
            <h3>VICTOR 球拍袋 羽球拍袋 1支裝</h3>
            <p class="price">$150元</p>
            {% if user.is_authenticated %}
            <a class="add-to-cart">加入購物車</a>
            {% else %}
            <a href="{% url 'login' %}" class="login-to-cart">加入購物車</a>
            {% endif %}
        </div>

        <div class="product" data-id="8" data-name="VICTOR 運動毛巾 C-4159 F (1入)" data-price="200">
            <a href="{% url 'product08' %}">
                <img src="{%static 'images/market-08.jpg' %}" alt="VICTOR 運動毛巾 C-4159 F (1入)">
            </a>
            <h3>VICTOR 運動毛巾 C-4159 F (1入)</h3>
            <p class="price">$200元</p>
            {% if user.is_authenticated %}
            <a class="add-to-cart">加入購物車</a>
            {% else %}
            <a href="{% url 'login' %}" class="login-to-cart">加入購物車</a>
            {% endif %}
        </div>

    </div>
    <div class="button-container">
        <a href="{% url 'home' %}"><button class="i-button">回首頁</button></a>
    </div>
</div>

<script>
    document.getElementById('cart-link').addEventListener('click', function () {
        {% if user.is_authenticated %}
        // 如果使用者已登入，則跳轉到購物車頁面
        window.location.href = "{% url 'shopingcar' %}";
        {% else %}
        // 如果使用者未登入，顯示提示並跳轉到登入頁面
        alert("請先登入以查看購物車");
        window.location.href = "{% url 'login' %}";
        {% endif %}
    });
    const addToCartButtons = document.querySelectorAll('.add-to-cart');
    const loginToCartLinks = document.querySelectorAll('.login-to-cart');

    addToCartButtons.forEach(button => {
        button.addEventListener('click', () => {
            const product = button.parentElement;
            const id = product.getAttribute('data-id');
            const name = product.getAttribute('data-name');
            const price = parseInt(product.getAttribute('data-price'), 10);

            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            cart.push({ id, name, price });
            localStorage.setItem('cart', JSON.stringify(cart));

            const cartIcon = document.querySelector('.cart-icon');
            const itemCount = document.getElementById('item-count');

            if (cart.length > 0) {
                cartIcon.classList.add('has-items');
                itemCount.textContent = cart.length;
            } else {
                cartIcon.classList.remove('has-items');
                itemCount.textContent = 0;
            }

            alert(`${name} 已加入購物車!`);
        });
    });

    loginToCartLinks.forEach(link => {
        link.addEventListener('click', () => {
            alert("請先登入才能加入購物車!");
            window.location.href = "{% url 'login' %}";
        });
    });

    let cart = JSON.parse(localStorage.getItem('cart')) || [];
    const cartIcon = document.querySelector('.cart-icon');
    if (cart.length > 0) {
        cartIcon.classList.add('has-items');
        document.getElementById('item-count').textContent = cart.length;
    }
</script>

{% endblock %}
